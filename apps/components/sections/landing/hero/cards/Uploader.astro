---
import 'dropzone/dist/dropzone.css';
import CardWrapper from '../CardWrapper.astro';
import birdImg1 from '@assets/images/landing/hero-cards/bird1.avif';
import birdImg2 from '@assets/images/landing/hero-cards/bird2.avif';
import birdImg3 from '@assets/images/landing/hero-cards/bird3.avif';
import birdImg4 from '@assets/images/landing/hero-cards/bird4.avif';
import birdImg5 from '@assets/images/landing/hero-cards/bird5.avif';

const uploadedImages = [
  { image: birdImg1 },
  { image: birdImg2 },
  { image: birdImg3 },
  { image: birdImg4 },
  { image: birdImg5 },
];
---

<CardWrapper color="secondary" class="shadow-secondary/5 dark:shadow-secondary-darker/5">
  <h3 class="mb-4 text-base font-bold">Uploader</h3>
  <form
    id="my-dropzone"
    class="dropzone mb-4 h-15 flex items-center justify-center !min-h-0 !border-1 !border-dashed !border-base !rounded-lg bg-muted"
  >
  </form>

  <!-- Preview container -->
  <div id="preview-container" class="flex flex-wrap gap-3">
    {
      uploadedImages.map((item, index) => (
        <div class="relative w-14 h-14" data-default>
          <img src={item.image.src} alt="Uploaded preview" class="object-cover w-full h-full rounded-lg" />
          <button
            type="button"
            class="remove-btn h-3 w-3 flex items-center justify-center absolute -top-1 -right-1 text-white bg-dark rounded-full"
          >
            <svg width="9" height="8" viewBox="0 0 9 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M4.39766 4.34995L2.64766 6.09995C2.59766 6.14995 2.53932 6.17495 2.47266 6.17495C2.40599 6.17495 2.34766 6.14995 2.29766 6.09995C2.24766 6.04995 2.22266 5.99162 2.22266 5.92495C2.22266 5.85828 2.24766 5.79995 2.29766 5.74995L4.04766 3.99995L2.29766 2.24995C2.24766 2.19995 2.22266 2.14162 2.22266 2.07495C2.22266 2.00828 2.24766 1.94995 2.29766 1.89995C2.34766 1.84995 2.40599 1.82495 2.47266 1.82495C2.53932 1.82495 2.59766 1.84995 2.64766 1.89995L4.39766 3.64995L6.14766 1.89995C6.19766 1.84995 6.25599 1.82495 6.32266 1.82495C6.38932 1.82495 6.44766 1.84995 6.49766 1.89995C6.54766 1.94995 6.57266 2.00828 6.57266 2.07495C6.57266 2.14162 6.54766 2.19995 6.49766 2.24995L4.74766 3.99995L6.49766 5.74995C6.54766 5.79995 6.57266 5.85828 6.57266 5.92495C6.57266 5.99162 6.54766 6.04995 6.49766 6.09995C6.44766 6.14995 6.38932 6.17495 6.32266 6.17495C6.25599 6.17495 6.19766 6.14995 6.14766 6.09995L4.39766 4.34995Z"
                fill="currentColor"
              />
            </svg>
          </button>
        </div>
      ))
    }
  </div>

  <script>
    import Dropzone from 'dropzone';
    Dropzone.autoDiscover = false;

    new Dropzone('#my-dropzone', {
      url: '/api/upload',
      maxFilesize: 2,
      acceptedFiles: 'image/*',
      previewsContainer: '#preview-container',
      dictDefaultMessage: `<div class="flex items-center gap-2">
        <svg
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M4.25 17.5C3.91667 17.5 3.625 17.375 3.375 17.125C3.125 16.875 3 16.5833 3 16.25V3.75C3 3.41667 3.125 3.125 3.375 2.875C3.625 2.625 3.91667 2.5 4.25 2.5H12.1458C12.3264 2.5 12.4757 2.55903 12.5937 2.67708C12.7118 2.79514 12.7708 2.94444 12.7708 3.125C12.7708 3.30556 12.7118 3.45486 12.5937 3.57292C12.4757 3.69097 12.3264 3.75 12.1458 3.75H4.25V16.25H16.75V8.375C16.75 8.19444 16.809 8.04514 16.9271 7.92708C17.0451 7.80903 17.1944 7.75 17.375 7.75C17.5556 7.75 17.7049 7.80903 17.8229 7.92708C17.941 8.04514 18 8.19444 18 8.375V16.25C18 16.5833 17.875 16.875 17.625 17.125C17.375 17.375 17.0833 17.5 16.75 17.5H4.25ZM15.7083 7.125C15.5278 7.125 15.3785 7.06597 15.2604 6.94792C15.1424 6.82986 15.0833 6.68056 15.0833 6.5V5.4375H14.0208C13.8403 5.4375 13.691 5.37847 13.5729 5.26042C13.4549 5.14236 13.3958 4.99306 13.3958 4.8125C13.3958 4.63194 13.4549 4.48264 13.5729 4.36458C13.691 4.24653 13.8403 4.1875 14.0208 4.1875H15.0833V3.125C15.0833 2.94444 15.1424 2.79514 15.2604 2.67708C15.3785 2.55903 15.5278 2.5 15.7083 2.5C15.8889 2.5 16.0382 2.55903 16.1562 2.67708C16.2743 2.79514 16.3333 2.94444 16.3333 3.125V4.1875H17.3958C17.5764 4.1875 17.7257 4.24653 17.8437 4.36458C17.9618 4.48264 18.0208 4.63194 18.0208 4.8125C18.0208 4.99306 17.9618 5.14236 17.8437 5.26042C17.7257 5.37847 17.5764 5.4375 17.3958 5.4375H16.3333V6.5C16.3333 6.68056 16.2743 6.82986 16.1562 6.94792C16.0382 7.06597 15.8889 7.125 15.7083 7.125ZM6.14583 14.125H14.875C15.0139 14.125 15.1111 14.0694 15.1667 13.9583C15.2222 13.8472 15.2083 13.7361 15.125 13.625L12.75 10.4583C12.6806 10.375 12.5972 10.3333 12.5 10.3333C12.4028 10.3333 12.3194 10.375 12.25 10.4583L9.85417 13.6042L8.14583 11.3542C8.07639 11.2708 7.99305 11.2292 7.89583 11.2292C7.79861 11.2292 7.71528 11.2708 7.64583 11.3542L5.89583 13.625C5.82639 13.7361 5.82292 13.8472 5.88542 13.9583C5.94792 14.0694 6.03472 14.125 6.14583 14.125ZM4.25 8.375V16.25V3.75V6.60417C4.25 6.78472 4.25 6.93403 4.25 7.05208C4.25 7.17014 4.25 7.22917 4.25 7.22917V7.75C4.25 7.93056 4.25 8.07986 4.25 8.19792C4.25 8.31597 4.25 8.375 4.25 8.375Z"
            fill="currentColor"></path>
        </svg>
        <p class="mb-0 text-xs">
          <span>Drop files here</span>
          <span class="mx-1 text-subtle">or</span>
          <span class="text-primary">browse from device</span>
        </p>
      </div>`,
      previewTemplate: `
        <div class="relative w-14 h-14">
          <img data-dz-thumbnail class="object-cover w-full h-full rounded-lg" />
          <button data-dz-remove
            class="h-3 w-3 flex items-center justify-center absolute -top-1 -right-1 text-white dark:text-black bg-dark rounded-full">
            <svg width="9" height="8" viewBox="0 0 9 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4.39766 4.34995L2.64766 6.09995C2.59766 6.14995 2.53932 6.17495 2.47266 6.17495C2.40599 6.17495 2.34766 6.14995 2.29766 6.09995C2.24766 6.04995 2.22266 5.99162 2.22266 5.92495C2.22266 5.85828 2.24766 5.79995 2.29766 5.74995L4.04766 3.99995L2.29766 2.24995C2.24766 2.19995 2.22266 2.14162 2.22266 2.07495C2.22266 2.00828 2.24766 1.94995 2.29766 1.89995C2.34766 1.84995 2.40599 1.82495 2.47266 1.82495C2.53932 1.82495 2.59766 1.84995 2.64766 1.89995L4.39766 3.64995L6.14766 1.89995C6.19766 1.84995 6.25599 1.82495 6.32266 1.82495C6.38932 1.82495 6.44766 1.84995 6.49766 1.89995C6.54766 1.94995 6.57266 2.00828 6.57266 2.07495C6.57266 2.14162 6.54766 2.19995 6.49766 2.24995L4.74766 3.99995L6.49766 5.74995C6.54766 5.79995 6.57266 5.85828 6.57266 5.92495C6.57266 5.99162 6.54766 6.04995 6.49766 6.09995C6.44766 6.14995 6.38932 6.17495 6.32266 6.17495C6.25599 6.17495 6.19766 6.14995 6.14766 6.09995L4.39766 4.34995Z" fill="currentColor"/>
            </svg>
          </button>
        </div>
      `,
    });

    document.querySelectorAll('#preview-container [data-default] .remove-btn').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        const parent = (e.currentTarget as HTMLElement).closest('[data-default]');
        if (parent) parent.remove();
      });
    });
  </script>
</CardWrapper>
