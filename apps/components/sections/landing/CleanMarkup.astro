---
import { tabsData } from 'apps/data/landing/clean-markup';
import SectionHeader from './common/SectionHeader.astro';
import SectionWrapper from './common/SectionWrapper.astro';
import CopyIcon from '@components/icons/CopyIcon.astro';
import CheckIcon from '@components/icons/CheckIcon.astro';
import cardImage from '@assets/images/landing/cards/nature.png';
import AppCode from '@components/common/AppCode.astro';
---

<SectionWrapper id="clean-markup" class="max-w-340">
  <SectionHeader
    title="Clean markup, full control."
    subtitle="Ditch long utility class strings. Hummingbird gives you complete freedom of pixel-perfect tweaks - plus full Tailwind flexibility."
  />

  <div class="flex flex-col lg:flex-row lg:h-112 gap-6">
    <!-- code tabs -->
    <div class="p-6 relative flex flex-col flex-1 max-h-88 lg:max-h-none overflow-hidden bg-muted rounded-2xl">
      <nav class="border-b border-base">
        <div class="nav nav-underline gap-1" role="tablist">
          {
            tabsData.map((tab) => (
              <button
                class={`nav-link font-bold px-2 h-9 text-sm ${tab.active ? 'active' : ''}`}
                id={`${tab.id}-tab`}
                data-bs-toggle="tab"
                data-bs-target={`#${tab.id}`}
                type="button"
                role="tab"
                aria-controls={tab.id}
                aria-selected={tab.active ? 'true' : 'false'}
              >
                {tab.label}
              </button>
            ))
          }
          <div id="cl-copy-btn" class="ml-auto p-0.5 cursor-pointer">
            <CopyIcon id="cl-copy-icon" />
            <CheckIcon id="cl-check-icon" class="hidden text-success" />
          </div>
        </div>
      </nav>

      <div class="tab-content flex overflow-hidden">
        {
          tabsData.map((tab) => (
            <div
              class={`tab-pane fade overflow-auto scrollbar-hide ${tab.active ? 'show active' : ''}`}
              id={tab.id}
              role="tabpanel"
              tabindex="0"
            >
              <AppCode
                class="h-full w-full !overflow-auto !bg-muted !px-0 scrollbar-hide"
                code={tab.code}
                lang="html"
              />
            </div>
          ))
        }
      </div>
    </div>

    <!-- card -->
    <div class="m-auto w-full max-w-90 shrink-0">
      <div class="card w-full">
        <div class="card-body space-y-3">
          <h1 class="card-title mb-4 text-center">Sign In</h1>
          <div class="form-field">
            <label class="form-label">Email</label>
            <input type="text" class="form-control" />
          </div>
          <div class="form-field mb-5">
            <label class="form-label">Password</label>
            <input type="text" class="form-control" />
          </div>
          <button class="btn btn-neutral w-full">Sign in</button>
        </div>
      </div>
    </div>
  </div>
</SectionWrapper>

<script>
  const copyBtn = document.querySelector('#cl-copy-btn') as HTMLButtonElement;
  const copyIcon = copyBtn.querySelector('#cl-copy-icon') as HTMLElement;
  const checkIcon = copyBtn.querySelector('#cl-check-icon') as HTMLElement;

  copyBtn.addEventListener('click', async () => {
    const activeTab = document.querySelector('.tab-pane.show.active code');
    if (!activeTab) return;

    try {
      await navigator.clipboard.writeText(activeTab.textContent);
      copyIcon.classList.add('hidden');
      checkIcon.classList.remove('hidden');

      setTimeout(() => {
        checkIcon.classList.add('hidden');
        copyIcon.classList.remove('hidden');
      }, 1500);
    } catch (err) {
      console.error('Failed to copy:', err);
    }
  });
</script>
