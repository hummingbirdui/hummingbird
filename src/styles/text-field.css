@utility form-control {
  --file-selector-btn-bg: var(--color-highlight);
  --file-selector-btn-content: var(--color-default-color);
  --file-selector-btn-hover-bg: var(--color-emphasis);

  @apply relative inline-flex items-center justify-center transition duration-200 gap-2 appearance-none
    leading-[var(--input-btn-line-height)]
    bg-[var(--input-bg)]
    text-[length:var(--input-btn-font-size)]
    text-[var(--input-content)]
    rounded-[var(--input-btn-radius)]
    shadow-[0_0_0_1px_var(--input-border-color)]
    px-[var(--input-btn-padding-x)]
    py-[var(--input-btn-padding-y)];
  & :where(input) {
    @apply w-full flex-1 appearance-none pt-0 pb-0 py-[var(--input-btn-padding-y)];
  }
  &:not(:has(input)) {
    @apply px-[var(--input-btn-padding-x)] py-[var(--input-btn-padding-y)];
  }
  &:is(:disabled, [disabled]),
  &:has(> input[disabled]) {
    --input-bg: var(--input-disabled-bg, var(--color-highlight));
    &:hover {
      --input-bg: var(--input-disabled-bg, var(--color-highlight));
    }
  }

  &:hover {
    --input-bg: var(--input-hover-bg, var(--color-highlight));
  }
  &:focus-within,
  &:focus {
    input,
    textarea {
      @apply outline-0;
    }
    @apply outline-0;
    --input-bg: var(--input-focus-bg, var(--color-primary-lighter));
    --input-border-color: var(--input-focus-border-color, var(--color-primary));
  }
  &.is-invalid {
    --input-bg: var(--color-error-lighter);
    --input-border-color: var(--color-error);
  }
  &[type="file"] {
    overflow: hidden;

    &:not(:disabled):not([readonly]) {
      cursor: pointer;
    }
  }
  &::file-selector-button {
    @apply pointer-events-none transition-[background] duration-200
      bg-[var(--file-selector-btn-bg)]
      text-[var(--file-selector-btn-content)]
      font-semibold
      px-[var(--input-btn-padding-x)]
      py-[var(--input-btn-padding-y)]
      -mx-[var(--input-btn-padding-x)]
      -my-[var(--input-btn-padding-y)]
      me-[var(--input-btn-padding-x)];
  }
  &:hover:not(:disabled):not([readonly])::file-selector-button {
    --file-selector-btn-bg: var(--file-selector-btn-hover-bg);
  }
  &.is-invalid::file-selector-button {
    --file-selector-btn-bg: var(--color-error);
    --file-selector-btn-content: var(--color-contrast);
    --file-selector-btn-hover-bg: var(--color-error-dark);
  }
  &:is(:disabled, [disabled])::file-selector-button {
    --file-selector-btn-bg: var(--color-muted);
  }
}

@utility form-control-outline {
  --input-border-color: var(--color-border-base);
  @apply relative inline-flex items-center justify-center transition duration-200 gap-2 appearance-none
    leading-[var(--input-btn-line-height)]
    text-[length:var(--input-btn-font-size)]
    text-[var(--input-content)]
    rounded-[var(--input-btn-radius)]
    shadow-[0_0_0_1px_var(--input-border-color)]
    px-[var(--input-btn-padding-x)]
    py-[var(--input-btn-padding-y)];
  & :where(input) {
    @apply w-full flex-1 appearance-none pt-0 pb-0 py-[var(--input-btn-padding-y)];
  }
  &:not(:has(input)) {
    @apply px-[var(--input-btn-padding-x)] py-[var(--input-btn-padding-y)];
  }
  &:is(:disabled, [disabled]),
  &:has(> input[disabled]) {
    @apply opacity-50;
    &:hover {
      --input-border-color: var(--color-border-base);
    }
    .form-label {
      --input-label-color: var(--color-disabled);
    }
  }
  &:hover {
    --input-border-color: var(--color-emphasis-color);
  }
  &:focus-within,
  &:focus {
    input,
    textarea {
      @apply outline-0;
    }
    @apply outline-0;
    --input-border-color: var(--input-focus-border-color, var(--color-primary));
  }
  &.is-invalid {
    --input-border-color: var(--color-error);
  }
  &[type="file"] {
    overflow: hidden;

    &:not(:disabled):not([readonly]) {
      cursor: pointer;
    }
  }
  &::file-selector-button {
    @apply pointer-events-none transition-[border] duration-200
    font-semibold
    px-[var(--input-btn-padding-x)]
    py-[var(--input-btn-padding-y)]
    -mx-[var(--input-btn-padding-x)]
    -my-[var(--input-btn-padding-y)]
    me-[var(--input-btn-padding-x)]
    border-r
    border-[var(--input-border-color)];
  }
}

@utility form-control-icon {
  @apply text-[20px] text-active; /* have to change the font-size */
}

@utility form-control-sm {
  --input-btn-padding-x: calc(var(--spacing) * 3);
  --input-btn-padding-y: calc(var(--spacing) * 1.5);
  --input-btn-radius: var(--radius-sm);
  --input-btn-line-height: 1.25;
  .form-control-icon {
    @apply text-sm;
  }
}
@utility form-control-lg {
  --input-btn-padding-y: calc(var(--spacing) * 2.5);
  --input-btn-font-size: var(--text-base);
  .form-control-icon {
    @apply text-xl;
  }
}
@utility form-control-primary {
  --file-selector-btn-bg: var(--color-primary);
  --file-selector-btn-content: var(--color-contrast);
  --file-selector-btn-hover-bg: var(--color-primary-dark);
}
@utility form-control-secondary {
  --input-focus-bg: var(--color-secondary-lighter);
  --input-focus-border-color: var(--color-secondary);
  --file-selector-btn-bg: var(--color-secondary);
  --file-selector-btn-content: var(--color-contrast);
  --file-selector-btn-hover-bg: var(--color-secondary-dark);
}
@utility form-control-info {
  --input-focus-bg: var(--color-info-lighter);
  --input-focus-border-color: var(--color-info);
  --file-selector-btn-bg: var(--color-info);
  --file-selector-btn-content: var(--color-contrast);
  --file-selector-btn-hover-bg: var(--color-info-dark);
}
@utility form-control-success {
  --input-focus-bg: var(--color-success-lighter);
  --input-focus-border-color: var(--color-success);
  --file-selector-btn-bg: var(--color-success);
  --file-selector-btn-content: var(--color-contrast);
  --file-selector-btn-hover-bg: var(--color-success-dark);
}
@utility form-control-warning {
  --input-focus-bg: var(--color-warning-lighter);
  --input-focus-border-color: var(--color-warning);
  --file-selector-btn-bg: var(--color-warning);
  --file-selector-btn-content: var(--color-contrast);
  --file-selector-btn-hover-bg: var(--color-warning-dark);
}

@utility form-label {
  @apply font-semibold text-[var(--input-label-color)] text-xs;
}

@utility form-field {
  @apply inline-flex flex-col gap-1;
  &:where(
      :has(
          .form-control,
          .form-control-outline,
          .form-select,
          .form-select-outline
        )
    ):focus-within {
    .form-label {
      --input-label-color: var(--color-primary);
    }
  }
  &:where(:has(.form-control-secondary, .form-select-secondary)):focus-within {
    .form-label {
      --input-label-color: var(--color-secondary);
    }
  }
  &:where(:has(.form-control-info, .form-select-info)):focus-within {
    .form-label {
      --input-label-color: var(--color-info);
    }
  }
  &:where(:has(.form-control-success, .form-select-success)):focus-within {
    .form-label {
      --input-label-color: var(--color-success);
    }
  }
  &:where(:has(.form-control-warning, .form-select-warning)):focus-within {
    .form-label {
      --input-label-color: var(--color-warning);
    }
  }
  &:where(:has(.is-invalid)),
  &:where(:has(.is-invalid)):focus-within {
    .form-label {
      --input-label-color: var(--color-error);
    }
  }
  &:has(input[disabled]) {
    .form-label {
      --input-label-color: var(--color-disabled);
    }
  }
}
